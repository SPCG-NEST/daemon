# Daemon

## Getting Started

To get started, you can install the daemon package and start building your own agents.

```bash
bun add @spacemangaming/daemon
```

### Daemon Class

- constructor()
  - Creates an empty Daemon, need to call init() to instance it
- init()
  - If provided a character file, will attempt to register a new character with the identity server
  - If _not_ provided a character file, will attempt to pull character from identity server
- add/removeMCPServer()
  - Allows adding IDaemonMCPServers and indexing their tools as needed
  - Indexes Server Tools (tools that need to be specifically called :- usually as bootstrap or through API), Context Tools (tools called during Context step of message lifecycle), Action Tools (tools called during Action step of message lifecycle) and Post Process Tools (tools called during Post Process step of the message lifecycle)
- message()
  - Kicks off the message processing lifecycle. Has options to _not_ call any of the lifecycle steps if need be and operate stateless
  - Messages call all the context tools in the daemon first to establish context
  - Input message + assembled context is fed as a prompt to the LLM for output
  - All registered action tools are called to see if they want to do anything based on the out LLM output
  - Post process tools are called to see if anything should be done about the total lifecycle message
  - Each step the tools are called in parallel for that step, without regard to order to speed up responses.

### IDaemonMCPServer

- getServerInfo() - returns the name and description of the server
- listServerTools() - lists the tools agents can call that are not part of the message lifecycle
- listContextTools() - lists the tools agents can call during Context Step of the message lifecycle
- listActionTools() - lists tools agents can call during the Actions step of the message lifecycle
- listPostProcessTools() - lists tools agents can call during the Post Process step of the message life cycle

### Character JSON

- name: Name of the Character
- pubkey: the public key of the character (solana style)
- model settings: the models to use for text generation and embedding (apiKeys are usually not stored in the character json but passed in during init)
- identity prompt: basic prompt that defines the Daemon
- identity server url: where the daemon should store it's logs
- bootstrap: a list of MCP servers that the daemon should connect to on startup and any tools it should call to bootstrap itself

### Message Lifecycle

- Daemon Pubkey - the Daemon's pubkey (used as ID to identify the daemon on servers)
- Message - The input message
- MessageId - a random id for the message, can be used by servers to store the message if they want
- CreatedAt - the date string when the message orginated
- Approval - signature with pubkey of the daemon and (message, createdAt, and messageId, channelId) to show that it's the specific daemon that's asking for the message to be processed by various servers (prevents people from pretending to be daemons and sending fake messages to servers)
- ChannelId - optional "room/thread/channel" to specify the message is within that context.
- daemonName - the name of the daemon
- IdentityPrompt - the Daemon's identity prompt
- Context - a list of context compiled with all context tools registered on the daemon
- Tools - a list of tools the daemon has access to
- GeneratedPrompt - the prompt generated by the LLM based on input message + context
- Output - the output generated by the LLM based on input message + context
- Hooks - a list of hooks the daemon will call (a hook is a tool that is called internally by the daemon and returns a result to a server)
- HooksLog - a list of logs from the hooks
- ActionsLogs - logs of any actions the servers took
- Post Process Logs - logs of any post processing steps the post processors took

### LLM.ts

- generateEmbeddings() - generated text embeddings for a given text input
- generateText() - generates text given input + context (prompt)
